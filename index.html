<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ø¨Ø±Ù‚Ú©Ø§Ø±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;600;700&display=swap');
        body { font-family: 'Vazirmatn', sans-serif; background: #f1f5f9; color: #334155; min-height: 100vh; margin: 0; }
        .container { max-width: 960px; margin: 0 auto; padding: 1rem; }
        .card { background: white; border-radius: 1rem; padding: 1.8rem; margin-bottom: 2rem; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        h1 { font-size: 2rem; font-weight: 700; text-align: center; color: #1e40af; margin: 2rem 0 1.5rem; }
        h2 { font-size: 1.4rem; font-weight: 700; color: #1e40af; border-bottom: 2px solid #3b82f6; padding-bottom: 0.5rem; margin-bottom: 1.5rem; }
        label { font-weight: 500; color: #475569; font-size: 1rem; margin-bottom: 0.5rem; display: block; }
        input[type="text"], textarea {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 1.5px solid #cbd5e1;
            border-radius: 0.75rem;
            background: #f8fafc;
            font-size: 1.1rem;
            font-weight: 700;
            color: #1e40af;
            text-align: center;
            padding-bottom: 19px;
            line-height: 1.8; /* Ú©Ù…Ú© Ø¨Ù‡ Ù†Ù…Ø§ÛŒØ´ Ø¨Ù‡ØªØ± Ø­Ø±ÙˆÙ ÙØ§Ø±Ø³ÛŒ */
        }
        input:focus, textarea:focus { outline: none; border-color: #3b82f6; padding-bottom: 15px; }
        .radio-group { display: flex; flex-wrap: wrap; gap: 1rem; margin-top: 0.5rem; justify-content: center; }
        .radio-item { display: flex; align-items: center; gap: 0.6rem; background: #eff6ff; padding: 0.7rem 1.2rem; border-radius: 1rem; font-size: 1rem; border: 1px solid #dbeafe; }
        button { background: linear-gradient(to right, #2563eb, #3b82f6); color: white; padding: 1rem 3rem; border-radius: 1.5rem; font-weight: 600; font-size: 1.2rem; box-shadow: 0 8px 25px rgba(59,130,246,0.4); transition: all 0.3s; margin: 1rem; border: none; }
        button:hover { transform: translateY(-4px); box-shadow: 0 12px 35px rgba(59,130,246,0.5); }
        .clear-btn { background: linear-gradient(to right, #dc2626, #ef4444); }
        table { width: 100%; border-collapse: separate; border-spacing: 0 0.8rem; }
        th { background: #dbeafe; padding: 0.9rem; text-align: center; font-weight: 600; font-size: 1rem; border-radius: 1rem; }
        td { background: #f8fafc; padding: 0.9rem; border-radius: 1rem; }
        td .radio-group { justify-content: center; gap: 0.5rem; }
        td .radio-item { padding: 0.5rem 0.8rem; font-size: 0.95rem; }
        .history-item { background: #f8fafc; padding: 1.5rem; border-radius: 1rem; border-right: 5px solid #3b82f6; margin-bottom: 1rem; }
        .total-input { background: #dbeafe; font-weight: 700; color: #1e40af; text-align: center; font-size: 1.2rem; }
        .alert { background: #fee2e2; color: #991b1b; padding: 1rem; border-radius: 1rem; font-weight: 600; border-right: 4px solid #ef4444; }
        .pdf-hide { display: block; }
        @media (max-width: 768px) {
            .container { padding: 0.8rem; }
            .card { padding: 1.5rem; }
            h1 { font-size: 1.8rem; }
            h2 { font-size: 1.3rem; }
            button { padding: 0.9rem 2.5rem; font-size: 1.1rem; }
            .radio-item { padding: 0.6rem 1rem; font-size: 0.95rem; }
        }
    </style>
</head>
<body>
    <div class="container" id="pdf-content">
        <h1>ÙØ±Ù… Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ø¨Ø±Ù‚Ú©Ø§Ø±</h1>

        <form id="evaluation-form" class="card">
            <!-- Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ ÙØ±Ù… Ù…Ø«Ù„ Ù‚Ø¨Ù„ -->
            <!-- (ØªÙ…Ø§Ù… Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Û± ØªØ§ Û¸ Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ Ù‡Ù…Ø§Ù† Ù‚Ø¨Ù„ÛŒ Ù‡Ø³ØªÙ†Ø¯ØŒ ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ú©ÙˆØªØ§Ù‡ Ø´Ø¯Ù† Ø§ÛŒÙ†Ø¬Ø§ Ú©Ù¾ÛŒ Ù†Ú©Ø±Ø¯Ù…) -->
            <!-- ØªÙ…Ø§Ù… HTML ÙØ±Ù… Ø´Ù…Ø§ Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± Ù…Ø§Ù†Ø¯Ù‡ Ø§Ø³Øª -->
            <!-- ÙÙ‚Ø· ÛŒÚ© Ø®Ø· Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡ Ø¯Ø± input ØªØ§Ø±ÛŒØ®: readonly Ùˆ id Ø¯Ø±Ø³Øª -->

            <div>
                <h2>Ø¨Ø®Ø´ Û± | Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¹Ù…ÙˆÙ…ÛŒ</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    <div><label>Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø¨Ø±Ù‚Ú©Ø§Ø±</label><input type="text" id="electrician_name" required></div>
                    <div><label>Ú©Ø¯ Ø¹Ø¶ÙˆÛŒØª / Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³</label><input type="text" id="membership_code"></div>
                    <div class="md:col-span-2"><label>Ù†Ø´Ø§Ù†ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡ Ù…ÙˆØ±Ø¯ Ø¨Ø§Ø²Ø¯ÛŒØ¯</label><input type="text" id="project_address"></div>
                    <div><label>Ù†ÙˆØ¹ Ù¾Ø±ÙˆÚ˜Ù‡</label><div class="radio-group">
                        <div class="radio-item"><input type="radio" name="project_type" value="Ù…Ø³Ú©ÙˆÙ†ÛŒ"><span>Ù…Ø³Ú©ÙˆÙ†ÛŒ</span></div>
                        <div class="radio-item"><input type="radio" name="project_type" value="ØªØ¬Ø§Ø±ÛŒ"><span>ØªØ¬Ø§Ø±ÛŒ</span></div>
                        <div class="radio-item"><input type="radio" name="project_type" value="Ø§Ø¯Ø§Ø±ÛŒ"><span>Ø§Ø¯Ø§Ø±ÛŒ</span></div>
                        <div class="radio-item"><input type="radio" name="project_type" value="ØµÙ†Ø¹ØªÛŒ Ø³Ø¨Ú©"><span>ØµÙ†Ø¹ØªÛŒ Ø³Ø¨Ú©</span></div>
                    </div></div>
                    <div><label>ÙˆØ¶Ø¹ÛŒØª Ù¾Ø±ÙˆÚ˜Ù‡</label><div class="radio-group">
                        <div class="radio-item"><input type="radio" name="project_status" value="Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§"><span>Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§</span></div>
                        <div class="radio-item"><input type="radio" name="project_status" value="ØªÚ©Ù…ÛŒÙ„â€ŒØ´Ø¯Ù‡"><span>ØªÚ©Ù…ÛŒÙ„â€ŒØ´Ø¯Ù‡</span></div>
                    </div></div>
                    <div class="md:col-span-2"><label>ØªØ§Ø±ÛŒØ® Ùˆ Ø³Ø§Ø¹Øª Ø¨Ø§Ø²Ø¯ÛŒØ¯</label><input type="text" id="visit_datetime" class="total-input" readonly></div>
                </div>
            </div>

            <!-- Ø¨Ù‚ÛŒÙ‡ Ø¨Ø®Ø´â€ŒÙ‡Ø§ Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ Ù…Ø«Ù„ Ú©Ø¯ Ø§ØµÙ„ÛŒ Ø´Ù…Ø§ -->
            <!-- (Ø¨Ø®Ø´ Û² ØªØ§ Û¸ Ø±Ø§ Ù‡Ù…Ø§Ù†â€ŒØ·ÙˆØ± Ú©Ù‡ Ø¨ÙˆØ¯ Ú©Ù¾ÛŒ Ú©Ù†ÛŒØ¯) -->
            
            <!-- Ø¨Ø®Ø´ Û² -->
            <div class="mt-10">
                <h2>Ø¨Ø®Ø´ Û² | Ù…Ø´Ø®ØµØ§Øª Ø§Ø±Ø²ÛŒØ§Ø¨Ø§Ù†</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    <div><label>Ù†Ø§Ù… Ø§Ø±Ø²ÛŒØ§Ø¨ Ø§ÙˆÙ„</label><input type="text" id="evaluator1_name" required></div>
                    <div><label>Ù†Ø§Ù… Ø§Ø±Ø²ÛŒØ§Ø¨ Ø¯ÙˆÙ…</label><input type="text" id="evaluator2_name" required></div>
                </div>
                <div class="alert mt-5">â›” Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ø¨Ø§ÛŒØ¯ Ø­ØªÙ…Ø§Ù‹ ØªÙˆØ³Ø· Ø¯Ùˆ Ù†ÙØ± Ø§Ù†Ø¬Ø§Ù… Ø´ÙˆØ¯.</div>
            </div>

            <!-- Ø¨Ø®Ø´ Û³ -->
            <div class="mt-10">
                <h2>Ø¨Ø®Ø´ Û³ | Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ ÙÙ†ÛŒ Ùˆ Ø§Ø¬Ø±Ø§ÛŒÛŒ (Û³Û° Ø§Ù…ØªÛŒØ§Ø²)</h2>
                <table>
                    <thead><tr><th>Ø±Ø¯ÛŒÙ</th><th>Ø´Ø§Ø®Øµ</th><th colspan="6">Ø§Ù…ØªÛŒØ§Ø² (Û° ØªØ§ Ûµ)</th></tr></thead>
                    <tbody>
                        <tr><td>Û±</td><td>Ø±Ø¹Ø§ÛŒØª Ø§ØµÙˆÙ„ Ø³ÛŒÙ…â€ŒÚ©Ø´ÛŒ</td><td class="radio-group">
                            <div class="radio-item"><input type="radio" name="tech1" value="0">Û°</div><div class="radio-item"><input type="radio" name="tech1" value="1">Û±</div><div class="radio-item"><input type="radio" name="tech1" value="2">Û²</div><div class="radio-item"><input type="radio" name="tech1" value="3">Û³</div><div class="radio-item"><input type="radio" name="tech1" value="4">Û´</div><div class="radio-item"><input type="radio" name="tech1" value="5">Ûµ</div>
                        </td></tr>
                        <tr><td>Û²</td><td>Ú©ÛŒÙÛŒØª ØªØ§Ø¨Ù„Ùˆ Ø¨Ø±Ù‚</td><td class="radio-group">
                            <div class="radio-item"><input type="radio" name="tech2" value="0">Û°</div><div class="radio-item"><input type="radio" name="tech2" value="1">Û±</div><div class="radio-item"><input type="radio" name="tech2" value="2">Û²</div><div class="radio-item"><input type="radio" name="tech2" value="3">Û³</div><div class="radio-item"><input type="radio" name="tech2" value="4">Û´</div><div class="radio-item"><input type="radio" name="tech2" value="5">Ûµ</div>
                        </td></tr>
                        <tr><td>Û³</td><td>Ø§ÛŒÙ…Ù†ÛŒ Ø§Ø¬Ø±Ø§ (Ø§ØªØµØ§Ù„Ø§ØªØŒ Ø§Ø±ØªØŒ Ø­ÙØ§Ø¸Øª)</td><td class="radio-group">
                            <div class="radio-item"><input type="radio" name="tech3" value="0">Û°</div><div class="radio-item"><input type="radio" name="tech3" value="1">Û±</div><div class="radio-item"><input type="radio" name="tech3" value="2">Û²</div><div class="radio-item"><input type="radio" name="tech3" value="3">Û³</div><div class="radio-item"><input type="radio" name="tech3" value="4">Û´</div><div class="radio-item"><input type="radio" name="tech3" value="5">Ûµ</div>
                        </td></tr>
                        <tr><td>Û´</td><td>Ù†Ø¸Ù…ØŒ ØªÙ…ÛŒØ²ÛŒ Ùˆ Ø²ÛŒØ¨Ø§ÛŒÛŒ Ú©Ø§Ø±</td><td class="radio-group">
                            <div class="radio-item"><input type="radio" name="tech4" value="0">Û°</div><div class="radio-item"><input type="radio" name="tech4" value="1">Û±</div><div class="radio-item"><input type="radio" name="tech4" value="2">Û²</div><div class="radio-item"><input type="radio" name="tech4" value="3">Û³</div><div class="radio-item"><input type="radio" name="tech4" value="4">Û´</div><div class="radio-item"><input type="radio" name="tech4" value="5">Ûµ</div>
                        </td></tr>
                        <tr><td>Ûµ</td><td>Ø±Ø¹Ø§ÛŒØª Ø­Ø¯Ø§Ù‚Ù„â€ŒÙ‡Ø§ÛŒ Ù…Ø¨Ø­Ø« Û±Û³</td><td class="radio-group">
                            <div class="radio-item"><input type="radio" name="tech5" value="0">Û°</div><div class="radio-item"><input type="radio" name="tech5" value="1">Û±</div><div class="radio-item"><input type="radio" name="tech5" value="2">Û²</div><div class="radio-item"><input type="radio" name="tech5" value="3">Û³</div><div class="radio-item"><input type="radio" name="tech5" value="4">Û´</div><div class="radio-item"><input type="radio" name="tech5" value="5">Ûµ</div>
                        </td></tr>
                    </tbody>
                </table>
                <div class="mt-5"><label>Ø¬Ù…Ø¹ Ø§Ù…ØªÛŒØ§Ø² Ø§ÛŒÙ† Ø¨Ø®Ø´ (Ø§Ø² Û³Û°)</label><input type="text" id="section3_total" class="total-input" readonly></div>
            </div>

            <!-- Ø¨Ø®Ø´ Û´ -->
            <div class="mt-10">
                <h2>Ø¨Ø®Ø´ Û´ | Ø±Ø¹Ø§ÛŒØª Ù†Ø±Ø®Ù†Ø§Ù…Ù‡ Ùˆ Ø§ØµÙˆÙ„ ØµÙ†ÙÛŒ (Û²Û° Ø§Ù…ØªÛŒØ§Ø²)</h2>
                <table>
                    <thead><tr><th>Ø±Ø¯ÛŒÙ</th><th>Ù…ÙˆØ±Ø¯ Ø¨Ø±Ø±Ø³ÛŒ</th><th>ÙˆØ¶Ø¹ÛŒØª</th></tr></thead>
                    <tbody>
                        <tr><td>Û±</td><td>Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ ÛŒØ§ ØªÙˆØ§ÙÙ‚ Ù…Ø´Ø®Øµ Ø¯Ø§Ø±Ø¯</td><td class="radio-group"><div class="radio-item"><input type="radio" name="rule1" value="5">Ø¨Ù„Ù‡</div><div class="radio-item"><input type="radio" name="rule1" value="0">Ø®ÛŒØ±</div></td></tr>
                        <tr><td>Û²</td><td>Ù‚ÛŒÙ…Øª Ù…Ø·Ø§Ø¨Ù‚ Ù†Ø±Ø®Ù†Ø§Ù…Ù‡ Ú©Ù…ÛŒØªÙ‡</td><td class="radio-group"><div class="radio-item"><input type="radio" name="rule2" value="5">Ø¨Ù„Ù‡</div><div class="radio-item"><input type="radio" name="rule2" value="0">Ø®ÛŒØ±</div></td></tr>
                        <tr><td>Û³</td><td>Ø¹Ø¯Ù… Ù‚ÛŒÙ…Øªâ€ŒØ´Ú©Ù†ÛŒ</td><td class="radio-group"><div class="radio-item"><input type="radio" name="rule3" value="5">Ø¨Ù„Ù‡</div><div class="radio-item"><input type="radio" name="rule3" value="0">Ø®ÛŒØ±</div></td></tr>
                        <tr><td>Û´</td><td>Ø´Ú©Ø§ÛŒØª Ù…Ø§Ù„ÛŒ Ø«Ø¨Øªâ€ŒØ´Ø¯Ù‡ Ù†Ø¯Ø§Ø±Ø¯</td><td class="radio-group"><div class="radio-item"><input type="radio" name="rule4" value="5">Ø¨Ù„Ù‡</div><div class="radio-item"><input type="radio" name="rule4" value="0">Ø®ÛŒØ±</div></td></tr>
                    </tbody>
                </table>
                <div class="mt-5"><label>Ø§Ù…ØªÛŒØ§Ø² Ø§ÛŒÙ† Ø¨Ø®Ø´ (Û° ØªØ§ Û²Û°)</label><input type="text" id="section4_total" class="total-input" readonly></div>
            </div>

            <!-- Ø¨Ø®Ø´ Ûµ -->
            <div class="mt-10">
                <h2>Ø¨Ø®Ø´ Ûµ | Ú©ÛŒÙÛŒØª Ú©Ù„ÛŒ Ø§Ø¬Ø±Ø§ (Û±Ûµ Ø§Ù…ØªÛŒØ§Ø²)</h2>
                <div class="grid grid-cols-1 gap-5">
                    <div><label>Ú©ÛŒÙÛŒØª Ú©Ù„ÛŒ Ø§Ø¬Ø±Ø§</label><div class="radio-group">
                        <div class="radio-item"><input type="radio" name="quality" value="0">Ø¶Ø¹ÛŒÙ</div>
                        <div class="radio-item"><input type="radio" name="quality" value="5">Ù…ØªÙˆØ³Ø·</div>
                        <div class="radio-item"><input type="radio" name="quality" value="10">Ø®ÙˆØ¨</div>
                        <div class="radio-item"><input type="radio" name="quality" value="15">Ø¹Ø§Ù„ÛŒ</div>
                    </div></div>
                </div>
                <div class="mt-5"><label>Ø§Ù…ØªÛŒØ§Ø² Ø§ÛŒÙ† Ø¨Ø®Ø´ (Û° ØªØ§ Û±Ûµ)</label><input type="text" id="section5_total" class="total-input" readonly></div>
            </div>

            <!-- Ø¨Ø®Ø´ Û¶ -->
            <div class="mt-10">
                <h2>Ø¨Ø®Ø´ Û¶ | Ø³Ø§Ø¨Ù‚Ù‡ Ùˆ ØªØ¬Ø±Ø¨Ù‡ Ú©Ø§Ø±ÛŒ (Û²Û° Ø§Ù…ØªÛŒØ§Ø²)</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    <div><label>Ø³Ø§Ø¨Ù‚Ù‡ Ú©Ø§Ø±ÛŒ Ø§Ø¹Ù„Ø§Ù…â€ŒØ´Ø¯Ù‡ (Ø³Ø§Ù„)</label><input type="text" id="experience_years"></div>
                    <div><label>Ø³Ø·Ø­ ØªØ¬Ø±Ø¨Ù‡</label><div class="radio-group">
                        <div class="radio-item"><input type="radio" name="exp_level" value="5">Ú©Ù…ØªØ± Ø§Ø² Ûµ Ø³Ø§Ù„</div>
                        <div class="radio-item"><input type="radio" name="exp_level" value="10">Ûµ ØªØ§ Û±Û° Ø³Ø§Ù„</div>
                        <div class="radio-item"><input type="radio" name="exp_level" value="15">Û±Û° ØªØ§ Û²Û° Ø³Ø§Ù„</div>
                        <div class="radio-item"><input type="radio" name="exp_level" value="20">Ø¨ÛŒØ´ Ø§Ø² Û²Û° Ø³Ø§Ù„</div>
                    </div></div>
                </div>
                <div class="mt-5"><label>Ø§Ù…ØªÛŒØ§Ø² Ø§ÛŒÙ† Ø¨Ø®Ø´ (Û° ØªØ§ Û²Û°)</label><input type="text" id="section6_total" class="total-input" readonly></div>
            </div>

            <!-- Ø¨Ø®Ø´ Û· -->
            <div class="mt-10">
                <h2>Ø¨Ø®Ø´ Û· | Ø§Ø¹ØªØ¨Ø§Ø± Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ùˆ Ù‡Ù…Ú©Ø§Ø±ÛŒ ØµÙ†ÙÛŒ (Û±Ûµ Ø§Ù…ØªÛŒØ§Ø²)</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-5">
                    <div><label>Ù‡Ù…Ú©Ø§Ø±ÛŒ Ø¨Ø§ Ú©Ù…ÛŒØªÙ‡</label><div class="radio-group">
                        <div class="radio-item"><input type="radio" name="cooperation" value="0">Ø¶Ø¹ÛŒÙ</div>
                        <div class="radio-item"><input type="radio" name="cooperation" value="3">Ù…ØªÙˆØ³Ø·</div>
                        <div class="radio-item"><input type="radio" name="cooperation" value="5">Ø®ÙˆØ¨</div>
                    </div></div>
                    <div><label>Ø±ÙØªØ§Ø± Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ø¯Ø± Ú©Ø§Ø±Ú¯Ø§Ù‡</label><div class="radio-group">
                        <div class="radio-item"><input type="radio" name="behavior" value="0">Ø¶Ø¹ÛŒÙ</div>
                        <div class="radio-item"><input type="radio" name="behavior" value="3">Ù…ØªÙˆØ³Ø·</div>
                        <div class="radio-item"><input type="radio" name="behavior" value="5">Ø®ÙˆØ¨</div>
                    </div></div>
                    <div><label>Ø³Ø§Ø¨Ù‚Ù‡ Ø´Ú©Ø§ÛŒØª</label><div class="radio-group">
                        <div class="radio-item"><input type="radio" name="complaint" value="0">Ø¯Ø§Ø±Ø¯</div>
                        <div class="radio-item"><input type="radio" name="complaint" value="5">Ù†Ø¯Ø§Ø±Ø¯</div>
                    </div></div>
                </div>
                <div class="mt-5"><label>Ø§Ù…ØªÛŒØ§Ø² Ø§ÛŒÙ† Ø¨Ø®Ø´ (Û° ØªØ§ Û±Ûµ)</label><input type="text" id="section7_total" class="total-input" readonly></div>
            </div>

            <!-- Ø¨Ø®Ø´ Û¸ -->
            <div class="mt-10">
                <h2>Ø¨Ø®Ø´ Û¸ | Ø¬Ù…Ø¹â€ŒØ¨Ù†Ø¯ÛŒ Ù†Ù‡Ø§ÛŒÛŒ</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    <div><label>Ø¬Ù…Ø¹ Ú©Ù„ Ø§Ù…ØªÛŒØ§Ø²Ø§Øª (Ø§Ø² Û±Û°Û°)</label><input type="text" id="total_score" class="total-input" readonly></div>
                    <div><label>Ø±ØªØ¨Ù‡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ</label><div class="radio-group">
                        <div class="radio-item"><input type="radio" name="rank" value="A">A</div>
                        <div class="radio-item"><input type="radio" name="rank" value="B">B</div>
                        <div class="radio-item"><input type="radio" name="rank" value="C">C</div>
                    </div></div>
                </div>
                <div class="mt-5"><label>Ù†Ø¸Ø± ØªÚ©Ù…ÛŒÙ„ÛŒ Ø§Ø±Ø²ÛŒØ§Ø¨Ø§Ù†</label><textarea rows="4" id="comments"></textarea></div>
            </div>
            <!-- ÙÙ‚Ø· Ø¨Ø®Ø´ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ -->
            <div class="text-center mt-16 pdf-hide">
                <button type="button" id="save-and-pdf-btn">Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø¯Ø§Ù†Ù„ÙˆØ¯ PDF</button>
                <button type="button" id="clear-all" class="clear-btn">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ ØªØ§Ø±ÛŒØ®Ú†Ù‡</button>
            </div>
        </form>

        <div class="card pdf-hide">
            <h2>ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒâ€ŒÙ‡Ø§</h2>
            <div id="history-list" class="space-y-5"></div>
        </div>
    </div>

    <script>
        // ØªØ§ÛŒÙ…Ø± Ø²Ù†Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ ØªØ§Ø±ÛŒØ® Ùˆ Ø³Ø§Ø¹Øª
        function updateDateTime() {
            const field = document.getElementById('visit_datetime');
            if (field) {
                const now = new Date();
                const options = {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: false
                };
                field.value = now.toLocaleString('fa-IR', options);
            }
        }

        // Ø¢Ù¾Ø¯ÛŒØª Ø§ÙˆÙ„ÛŒÙ‡ Ùˆ Ù‡Ø± Ø«Ø§Ù†ÛŒÙ‡
        updateDateTime();
        setInterval(updateDateTime, 1000);

        function calculateScores() {
            let s3 = 0;
            for (let i = 1; i <= 5; i++) {
                const checked = document.querySelector(`input[name="tech${i}"]:checked`);
                if (checked) s3 += parseInt(checked.value);
            }
            document.getElementById('section3_total').value = s3;

            let s4 = 0;
            for (let i = 1; i <= 4; i++) {
                const checked = document.querySelector(`input[name="rule${i}"]:checked`);
                if (checked) s4 += parseInt(checked.value);
            }
            document.getElementById('section4_total').value = s4;

            const quality = document.querySelector('input[name="quality"]:checked');
            document.getElementById('section5_total').value = quality ? parseInt(quality.value) : 0;

            const exp = document.querySelector('input[name="exp_level"]:checked');
            document.getElementById('section6_total').value = exp ? parseInt(exp.value) : 0;

            let s7 = 0;
            ['cooperation', 'behavior', 'complaint'].forEach(name => {
                const checked = document.querySelector(`input[name="${name}"]:checked`);
                if (checked) s7 += parseInt(checked.value);
            });
            document.getElementById('section7_total').value = s7;

            const total = s3 + s4 + (quality ? parseInt(quality.value) : 0) + (exp ? parseInt(exp.value) : 0) + s7;
            document.getElementById('total_score').value = total;
        }

        document.addEventListener('change', calculateScores);

        async function saveAndDownloadPDF() {
            calculateScores();

            // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± localStorage
            const data = {
                electrician_name: document.getElementById('electrician_name').value.trim() || 'Ù†Ø§Ù…Ø´Ø®Øµ',
                total_score: document.getElementById('total_score').value,
                rank: document.querySelector('input[name="rank"]:checked')?.value || 'â€”',
                timestamp: new Date().toLocaleString('fa-IR'),
                fullData: {}
            };

            document.querySelectorAll('#evaluation-form input[type="text"], #evaluation-form textarea').forEach(el => {
                data.fullData[el.id] = el.value;
            });
            document.querySelectorAll('#evaluation-form input[type="radio"]:checked').forEach(el => {
                data.fullData[el.name] = el.value;
            });

            let history = JSON.parse(localStorage.getItem('evaluations') || '[]');
            history.unshift(data);
            localStorage.setItem('evaluations', JSON.stringify(history));
            loadHistory();

            // Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ PDF
            const btn = document.getElementById('save-and-pdf-btn');
            btn.disabled = true;
            btn.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø³Ø§Ø®Øª PDF...';

            // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ùˆ ØªØ§Ø±ÛŒØ®Ú†Ù‡
            document.querySelectorAll('.pdf-hide').forEach(el => el.style.display = 'none');

            // Ø§ÙØ²Ø§ÛŒØ´ Ù…ÙˆÙ‚Øª line-height Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¨Ø±ÛŒØ¯Ù‡ Ø´Ø¯Ù† Ø­Ø±ÙˆÙ ÙØ§Ø±Ø³ÛŒ
            const originalLineHeights = [];
            document.querySelectorAll('input, textarea, p, span, div, td, th').forEach(el => {
                originalLineHeights.push({ el, lh: el.style.lineHeight });
                el.style.lineHeight = '2.2';
            });

            await new Promise(r => setTimeout(r, 600)); // Ú©Ù…ÛŒ ØµØ¨Ø± Ø¨Ø±Ø§ÛŒ Ø§Ø¹Ù…Ø§Ù„ ØªØºÛŒÛŒØ±Ø§Øª

            const element = document.getElementById('pdf-content');

            const canvas = await html2canvas(element, {
                scale: 3,                    // Ú©ÛŒÙÛŒØª Ø¨Ø§Ù„Ø§ØªØ±
                useCORS: true,
                backgroundColor: '#f1f5f9',
                logging: false,
                windowWidth: element.scrollWidth,
                windowHeight: element.scrollHeight,
                width: element.scrollWidth,
                height: element.scrollHeight,
                scrollX: 0,
                scrollY: 0
            });

            // Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù† line-height
            originalLineHeights.forEach(item => {
                item.el.style.lineHeight = item.lh || '';
            });

            // Ù†Ù…Ø§ÛŒØ´ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
            document.querySelectorAll('.pdf-hide').forEach(el => el.style.display = 'block');

            const imgData = canvas.toDataURL('image/png');
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');

            const pageWidth = pdf.internal.pageSize.getWidth();
            const pageHeight = pdf.internal.pageSize.getHeight();
            const margin = 10;
            const imgWidth = pageWidth - 2 * margin;
            const imgHeight = canvas.height * imgWidth / canvas.width;

            let heightLeft = imgHeight;
            let position = margin;

            pdf.addImage(imgData, 'PNG', margin, position, imgWidth, imgHeight);
            heightLeft -= pageHeight - 2 * margin;

            while (heightLeft > 0) {
                position = - (imgHeight - heightLeft) + margin;
                pdf.addPage();
                pdf.addImage(imgData, 'PNG', margin, position, imgWidth, imgHeight);
                heightLeft -= pageHeight - 2 * margin;
            }

            pdf.save(`Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ_${data.electrician_name || 'Ø¨Ø±Ù‚Ú©Ø§Ø±'}.pdf`);

            btn.disabled = false;
            btn.textContent = 'Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø¯Ø§Ù†Ù„ÙˆØ¯ PDF';

            // Ø±ÛŒØ³Øª ÙØ±Ù…
            document.getElementById('evaluation-form').reset();
            updateDateTime();
            calculateScores();

            alert('Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ùˆ PDF Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯ ğŸ’™');
        }

        // Ø¨Ù‚ÛŒÙ‡ ØªÙˆØ§Ø¨Ø¹ historyØŒ editØŒ delete Ùˆ clear-all Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ Ù…Ø«Ù„ Ù‚Ø¨Ù„
        function loadHistory() {
            const history = JSON.parse(localStorage.getItem('evaluations') || '[]');
            const list = document.getElementById('history-list');
            list.innerHTML = '';
            if (history.length === 0) {
                list.innerHTML = '<p class="text-center text-gray-500 py-6">Ù‡Ù†ÙˆØ² Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>';
                return;
            }
            history.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'history-item';
                div.innerHTML = `
                    <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-4">
                        <div>
                            <div class="font-semibold text-lg">${item.electrician_name}</div>
                            <div class="text-gray-600 text-sm mt-1">Ø§Ù…ØªÛŒØ§Ø²: ${item.total_score} | Ø±ØªØ¨Ù‡: ${item.rank} | ${item.timestamp}</div>
                        </div>
                        <div class="flex gap-3">
                            <button class="bg-blue-600 text-white px-6 py-2 rounded-lg" onclick="editEvaluation(${index})">ÙˆÛŒØ±Ø§ÛŒØ´</button>
                            <button class="bg-red-600 text-white px-6 py-2 rounded-lg" onclick="deleteEvaluation(${index})">Ø­Ø°Ù</button>
                        </div>
                    </div>
                `;
                list.appendChild(div);
            });
        }

        window.editEvaluation = function(index) {
            const history = JSON.parse(localStorage.getItem('evaluations') || '[]');
            const data = history[index].fullData;

            Object.keys(data).forEach(key => {
                if (key === 'visit_datetime') return;
                const textInput = document.getElementById(key);
                if (textInput) textInput.value = data[key];

                const radio = document.querySelector(`input[name="${key}"][value="${data[key]}"]`);
                if (radio) radio.checked = true;
            });

            calculateScores();
            history.splice(index, 1);
            localStorage.setItem('evaluations', JSON.stringify(history));
            loadHistory();
            window.scrollTo(0, 0);
        };

        window.deleteEvaluation = function(index) {
            if (confirm('Ø­Ø°Ù Ø§ÛŒÙ† Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒØŸ')) {
                const history = JSON.parse(localStorage.getItem('evaluations') || '[]');
                history.splice(index, 1);
                localStorage.setItem('evaluations', JSON.stringify(history));
                loadHistory();
            }
        };

        document.getElementById('clear-all').addEventListener('click', () => {
            if (confirm('Ù‡Ù…Ù‡ Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒâ€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø´ÙˆØ¯ØŸ')) {
                localStorage.removeItem('evaluations');
                loadHistory();
            }
        });

        document.getElementById('save-and-pdf-btn').addEventListener('click', saveAndDownloadPDF);

        loadHistory();
        calculateScores();
    </script>
</body>
</html>
